
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="package for ca_npa_howtopay">
      
      
        <meta name="author" content="Switchbox">
      
      
        <link rel="canonical" href="https://switchbox-data.github.io/npa-howtopay/modules/">
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../formulas/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.17">
    
    
      
        <title>Modules - npa-howtopay</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#modules" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="npa-howtopay" class="md-header__button md-logo" aria-label="npa-howtopay" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            npa-howtopay
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Modules
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/switchbox-data/npa-howtopay" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    switchbox-data/npa-howtopay
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="npa-howtopay" class="md-nav__button md-logo" aria-label="npa-howtopay" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    npa-howtopay
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/switchbox-data/npa-howtopay" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    switchbox-data/npa-howtopay
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#npa_howtopay.model" class="md-nav__link">
    <span class="md-ellipsis">
      model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.YearContext" class="md-nav__link">
    <span class="md-ellipsis">
      YearContext
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_avg_bill_per_user" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_avg_bill_per_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_converts_electric_bill_per_user" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_converts_electric_bill_per_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_converts_total_bill_per_user" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_converts_total_bill_per_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_electric_fixed_charge_per_user" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_electric_fixed_charge_per_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_electric_variable_tariff_per_kwh" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_electric_variable_tariff_per_kwh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_gas_fixed_charge_per_user" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_gas_fixed_charge_per_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_gas_variable_tariff_per_therm" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_gas_variable_tariff_per_therm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_nonconverts_electric_bill_per_user" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_nonconverts_electric_bill_per_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_nonconverts_gas_bill_per_user" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_nonconverts_gas_bill_per_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_nonconverts_total_bill_per_user" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_nonconverts_total_bill_per_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.compute_bill_costs" class="md-nav__link">
    <span class="md-ellipsis">
      compute_bill_costs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.compute_intermediate_cols_electric" class="md-nav__link">
    <span class="md-ellipsis">
      compute_intermediate_cols_electric
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.compute_intermediate_cols_gas" class="md-nav__link">
    <span class="md-ellipsis">
      compute_intermediate_cols_gas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.create_scenario_runs" class="md-nav__link">
    <span class="md-ellipsis">
      create_scenario_runs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.inflation_adjust_revenue_requirement" class="md-nav__link">
    <span class="md-ellipsis">
      inflation_adjust_revenue_requirement
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npa_howtopay.params" class="md-nav__link">
    <span class="md-ellipsis">
      params
    </span>
  </a>
  
    <nav class="md-nav" aria-label="params">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.params.TimeSeriesParams" class="md-nav__link">
    <span class="md-ellipsis">
      TimeSeriesParams
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TimeSeriesParams">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.params.TimeSeriesParams.__attrs_post_init__" class="md-nav__link">
    <span class="md-ellipsis">
      __attrs_post_init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.params.get_available_runs" class="md-nav__link">
    <span class="md-ellipsis">
      get_available_runs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.params.load_scenario_from_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      load_scenario_from_yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.params.load_time_series_params_from_web_params" class="md-nav__link">
    <span class="md-ellipsis">
      load_time_series_params_from_web_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.params.load_time_series_params_from_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      load_time_series_params_from_yaml
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project" class="md-nav__link">
    <span class="md-ellipsis">
      capex_project
    </span>
  </a>
  
    <nav class="md-nav" aria-label="capex_project">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.NpvSavingsProject" class="md-nav__link">
    <span class="md-ellipsis">
      NpvSavingsProject
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.compute_depreciation_expense_from_capex_projects" class="md-nav__link">
    <span class="md-ellipsis">
      compute_depreciation_expense_from_capex_projects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.compute_maintanence_costs" class="md-nav__link">
    <span class="md-ellipsis">
      compute_maintanence_costs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.compute_npv_of_capex_investment" class="md-nav__link">
    <span class="md-ellipsis">
      compute_npv_of_capex_investment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.compute_npv_savings_from_npa_projects" class="md-nav__link">
    <span class="md-ellipsis">
      compute_npv_savings_from_npa_projects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.compute_performance_incentive_this_year" class="md-nav__link">
    <span class="md-ellipsis">
      compute_performance_incentive_this_year
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.compute_ratebase_from_capex_projects" class="md-nav__link">
    <span class="md-ellipsis">
      compute_ratebase_from_capex_projects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.get_grid_upgrade_capex_projects" class="md-nav__link">
    <span class="md-ellipsis">
      get_grid_upgrade_capex_projects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.get_lpp_gas_capex_projects" class="md-nav__link">
    <span class="md-ellipsis">
      get_lpp_gas_capex_projects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.get_non_lpp_gas_capex_projects" class="md-nav__link">
    <span class="md-ellipsis">
      get_non_lpp_gas_capex_projects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.get_non_npa_electric_capex_projects" class="md-nav__link">
    <span class="md-ellipsis">
      get_non_npa_electric_capex_projects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.get_npa_capex_projects" class="md-nav__link">
    <span class="md-ellipsis">
      get_npa_capex_projects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.get_synthetic_initial_capex_projects" class="md-nav__link">
    <span class="md-ellipsis">
      get_synthetic_initial_capex_projects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.return_empty_npv_savings_df" class="md-nav__link">
    <span class="md-ellipsis">
      return_empty_npv_savings_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npa_howtopay.npa_project" class="md-nav__link">
    <span class="md-ellipsis">
      npa_project
    </span>
  </a>
  
    <nav class="md-nav" aria-label="npa_project">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.npa_project.append_scattershot_electrification_df" class="md-nav__link">
    <span class="md-ellipsis">
      append_scattershot_electrification_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npa_howtopay.web_params" class="md-nav__link">
    <span class="md-ellipsis">
      web_params
    </span>
  </a>
  
    <nav class="md-nav" aria-label="web_params">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.web_params.create_scattershot_electrification_df" class="md-nav__link">
    <span class="md-ellipsis">
      create_scattershot_electrification_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.web_params.create_time_series_from_web_params" class="md-nav__link">
    <span class="md-ellipsis">
      create_time_series_from_web_params
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../formulas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Formulas
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../variable_reference_table/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Input Parameter Reference Table
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#npa_howtopay.model" class="md-nav__link">
    <span class="md-ellipsis">
      model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.YearContext" class="md-nav__link">
    <span class="md-ellipsis">
      YearContext
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_avg_bill_per_user" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_avg_bill_per_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_converts_electric_bill_per_user" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_converts_electric_bill_per_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_converts_total_bill_per_user" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_converts_total_bill_per_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_electric_fixed_charge_per_user" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_electric_fixed_charge_per_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_electric_variable_tariff_per_kwh" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_electric_variable_tariff_per_kwh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_gas_fixed_charge_per_user" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_gas_fixed_charge_per_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_gas_variable_tariff_per_therm" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_gas_variable_tariff_per_therm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_nonconverts_electric_bill_per_user" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_nonconverts_electric_bill_per_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_nonconverts_gas_bill_per_user" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_nonconverts_gas_bill_per_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.calculate_nonconverts_total_bill_per_user" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_nonconverts_total_bill_per_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.compute_bill_costs" class="md-nav__link">
    <span class="md-ellipsis">
      compute_bill_costs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.compute_intermediate_cols_electric" class="md-nav__link">
    <span class="md-ellipsis">
      compute_intermediate_cols_electric
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.compute_intermediate_cols_gas" class="md-nav__link">
    <span class="md-ellipsis">
      compute_intermediate_cols_gas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.create_scenario_runs" class="md-nav__link">
    <span class="md-ellipsis">
      create_scenario_runs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.model.inflation_adjust_revenue_requirement" class="md-nav__link">
    <span class="md-ellipsis">
      inflation_adjust_revenue_requirement
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npa_howtopay.params" class="md-nav__link">
    <span class="md-ellipsis">
      params
    </span>
  </a>
  
    <nav class="md-nav" aria-label="params">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.params.TimeSeriesParams" class="md-nav__link">
    <span class="md-ellipsis">
      TimeSeriesParams
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TimeSeriesParams">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.params.TimeSeriesParams.__attrs_post_init__" class="md-nav__link">
    <span class="md-ellipsis">
      __attrs_post_init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.params.get_available_runs" class="md-nav__link">
    <span class="md-ellipsis">
      get_available_runs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.params.load_scenario_from_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      load_scenario_from_yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.params.load_time_series_params_from_web_params" class="md-nav__link">
    <span class="md-ellipsis">
      load_time_series_params_from_web_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.params.load_time_series_params_from_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      load_time_series_params_from_yaml
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project" class="md-nav__link">
    <span class="md-ellipsis">
      capex_project
    </span>
  </a>
  
    <nav class="md-nav" aria-label="capex_project">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.NpvSavingsProject" class="md-nav__link">
    <span class="md-ellipsis">
      NpvSavingsProject
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.compute_depreciation_expense_from_capex_projects" class="md-nav__link">
    <span class="md-ellipsis">
      compute_depreciation_expense_from_capex_projects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.compute_maintanence_costs" class="md-nav__link">
    <span class="md-ellipsis">
      compute_maintanence_costs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.compute_npv_of_capex_investment" class="md-nav__link">
    <span class="md-ellipsis">
      compute_npv_of_capex_investment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.compute_npv_savings_from_npa_projects" class="md-nav__link">
    <span class="md-ellipsis">
      compute_npv_savings_from_npa_projects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.compute_performance_incentive_this_year" class="md-nav__link">
    <span class="md-ellipsis">
      compute_performance_incentive_this_year
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.compute_ratebase_from_capex_projects" class="md-nav__link">
    <span class="md-ellipsis">
      compute_ratebase_from_capex_projects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.get_grid_upgrade_capex_projects" class="md-nav__link">
    <span class="md-ellipsis">
      get_grid_upgrade_capex_projects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.get_lpp_gas_capex_projects" class="md-nav__link">
    <span class="md-ellipsis">
      get_lpp_gas_capex_projects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.get_non_lpp_gas_capex_projects" class="md-nav__link">
    <span class="md-ellipsis">
      get_non_lpp_gas_capex_projects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.get_non_npa_electric_capex_projects" class="md-nav__link">
    <span class="md-ellipsis">
      get_non_npa_electric_capex_projects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.get_npa_capex_projects" class="md-nav__link">
    <span class="md-ellipsis">
      get_npa_capex_projects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.get_synthetic_initial_capex_projects" class="md-nav__link">
    <span class="md-ellipsis">
      get_synthetic_initial_capex_projects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.capex_project.return_empty_npv_savings_df" class="md-nav__link">
    <span class="md-ellipsis">
      return_empty_npv_savings_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npa_howtopay.npa_project" class="md-nav__link">
    <span class="md-ellipsis">
      npa_project
    </span>
  </a>
  
    <nav class="md-nav" aria-label="npa_project">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.npa_project.append_scattershot_electrification_df" class="md-nav__link">
    <span class="md-ellipsis">
      append_scattershot_electrification_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npa_howtopay.web_params" class="md-nav__link">
    <span class="md-ellipsis">
      web_params
    </span>
  </a>
  
    <nav class="md-nav" aria-label="web_params">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.web_params.create_scattershot_electrification_df" class="md-nav__link">
    <span class="md-ellipsis">
      create_scattershot_electrification_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npa_howtopay.web_params.create_time_series_from_web_params" class="md-nav__link">
    <span class="md-ellipsis">
      create_time_series_from_web_params
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="modules">Modules<a class="headerlink" href="#modules" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<h2 id="npa_howtopay.model" class="doc doc-heading">
            <code>npa_howtopay.model</code>


<a href="#npa_howtopay.model" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="npa_howtopay.model.YearContext" class="doc doc-heading">
            <code>YearContext</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#npa_howtopay.model.YearContext" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">


        <p>Context for all values needed in a given year</p>







              <details class="quote">
                <summary>Source code in <code>src/npa_howtopay/model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">YearContext</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context for all values needed in a given year&quot;&quot;&quot;</span>

    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">gas_ratebase</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">electric_ratebase</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">gas_depreciation_expense</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">electric_depreciation_expense</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">gas_maintenance_cost</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">electric_maintenance_cost</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">gas_npa_opex</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">electric_npa_opex</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">gas_performance_incentive</span><span class="p">:</span> <span class="nb">float</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.model.calculate_avg_bill_per_user" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_avg_bill_per_user</span><span class="p">(</span><span class="n">inflation_adjusted_revenue</span><span class="p">,</span> <span class="n">num_users</span><span class="p">)</span></code>

<a href="#npa_howtopay.model.calculate_avg_bill_per_user" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calculate the average bill per user by dividing total revenue by number of users.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>inflation_adjusted_revenue</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total revenue adjusted for inflation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_users</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total number of users to divide revenue among</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Average bill amount per user</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_avg_bill_per_user</span><span class="p">(</span><span class="n">inflation_adjusted_revenue</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">num_users</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the average bill per user by dividing total revenue by number of users.</span>

<span class="sd">    Args:</span>
<span class="sd">        inflation_adjusted_revenue: Total revenue adjusted for inflation</span>
<span class="sd">        num_users: Total number of users to divide revenue among</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Average bill amount per user</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">inflation_adjusted_revenue</span> <span class="o">/</span> <span class="n">num_users</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.model.calculate_converts_electric_bill_per_user" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_converts_electric_bill_per_user</span><span class="p">(</span><span class="n">electric_fixed_charge</span><span class="p">,</span> <span class="n">electric_variable_tariff</span><span class="p">,</span> <span class="n">per_user_electric_need</span><span class="p">,</span> <span class="n">per_user_heating_need</span><span class="p">,</span> <span class="n">per_user_water_heating_need</span><span class="p">,</span> <span class="n">hp_efficiency</span><span class="p">,</span> <span class="n">water_heater_efficiency</span><span class="p">)</span></code>

<a href="#npa_howtopay.model.calculate_converts_electric_bill_per_user" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calculate electric bill per user for converts (includes heating).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>electric_fixed_charge</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fixed charge per user</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>electric_variable_tariff</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variable tariff per kWh</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>per_user_electric_need</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Electric need per user</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>per_user_heating_need</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Heating need per user (therms)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>per_user_water_heating_need</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Water heating need per user (therms)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hp_efficiency</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Heat pump efficiency</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>water_heater_efficiency</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Water heater efficiency</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Electric bill per user for converts</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_converts_electric_bill_per_user</span><span class="p">(</span>
    <span class="n">electric_fixed_charge</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">electric_variable_tariff</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">per_user_electric_need</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">per_user_heating_need</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">per_user_water_heating_need</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">hp_efficiency</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">water_heater_efficiency</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate electric bill per user for converts (includes heating).</span>

<span class="sd">    Args:</span>
<span class="sd">        electric_fixed_charge: Fixed charge per user</span>
<span class="sd">        electric_variable_tariff: Variable tariff per kWh</span>
<span class="sd">        per_user_electric_need: Electric need per user</span>
<span class="sd">        per_user_heating_need: Heating need per user (therms)</span>
<span class="sd">        per_user_water_heating_need: Water heating need per user (therms)</span>
<span class="sd">        hp_efficiency: Heat pump efficiency</span>
<span class="sd">        water_heater_efficiency: Water heater efficiency</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Electric bill per user for converts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">add_on_usage</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">per_user_heating_need</span> <span class="o">*</span> <span class="n">KWH_PER_THERM</span> <span class="o">/</span> <span class="n">hp_efficiency</span>
        <span class="o">+</span> <span class="n">per_user_water_heating_need</span> <span class="o">*</span> <span class="n">KWH_PER_THERM</span> <span class="o">/</span> <span class="n">water_heater_efficiency</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">electric_fixed_charge</span> <span class="o">+</span> <span class="n">electric_variable_tariff</span> <span class="o">*</span> <span class="p">(</span><span class="n">per_user_electric_need</span> <span class="o">+</span> <span class="n">add_on_usage</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.model.calculate_converts_total_bill_per_user" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_converts_total_bill_per_user</span><span class="p">(</span><span class="n">converts_gas_bill</span><span class="p">,</span> <span class="n">converts_electric_bill</span><span class="p">)</span></code>

<a href="#npa_howtopay.model.calculate_converts_total_bill_per_user" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calculate total bill per user for converts (gas + electric).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>converts_gas_bill</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Gas bill per user for converts</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>converts_electric_bill</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Electric bill per user for converts</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total bill per user for converts</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_converts_total_bill_per_user</span><span class="p">(</span><span class="n">converts_gas_bill</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">converts_electric_bill</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate total bill per user for converts (gas + electric).</span>

<span class="sd">    Args:</span>
<span class="sd">        converts_gas_bill: Gas bill per user for converts</span>
<span class="sd">        converts_electric_bill: Electric bill per user for converts</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Total bill per user for converts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">converts_gas_bill</span> <span class="o">+</span> <span class="n">converts_electric_bill</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.model.calculate_electric_fixed_charge_per_user" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_electric_fixed_charge_per_user</span><span class="p">(</span><span class="n">fixed_charge</span><span class="p">)</span></code>

<a href="#npa_howtopay.model.calculate_electric_fixed_charge_per_user" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return electric fixed charge per user. Currently a user defined constant</p>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_electric_fixed_charge_per_user</span><span class="p">(</span><span class="n">fixed_charge</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return electric fixed charge per user. Currently a user defined constant&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">fixed_charge</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.model.calculate_electric_variable_tariff_per_kwh" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_electric_variable_tariff_per_kwh</span><span class="p">(</span><span class="n">electric_infl_adj_revenue</span><span class="p">,</span> <span class="n">total_electric_usage_kwh</span><span class="p">,</span> <span class="n">fixed_charge</span><span class="p">,</span> <span class="n">num_users</span><span class="p">)</span></code>

<a href="#npa_howtopay.model.calculate_electric_variable_tariff_per_kwh" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calculate electric variable cost per kWh.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>electric_infl_adj_revenue</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total electric revenue adjusted for inflation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_electric_usage_kwh</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total electric usage in kWh</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fixed_charge</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fixed charge per user</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_users</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of users</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variable cost per kWh calculated by subtracting total fixed charges
  from revenue and dividing by total usage</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_electric_variable_tariff_per_kwh</span><span class="p">(</span>
    <span class="n">electric_infl_adj_revenue</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">total_electric_usage_kwh</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">fixed_charge</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">num_users</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate electric variable cost per kWh.</span>

<span class="sd">    Args:</span>
<span class="sd">        electric_infl_adj_revenue: Total electric revenue adjusted for inflation</span>
<span class="sd">        total_electric_usage_kwh: Total electric usage in kWh</span>
<span class="sd">        fixed_charge: Fixed charge per user</span>
<span class="sd">        num_users: Number of users</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Variable cost per kWh calculated by subtracting total fixed charges</span>
<span class="sd">              from revenue and dividing by total usage</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">electric_infl_adj_revenue</span> <span class="o">-</span> <span class="n">num_users</span> <span class="o">*</span> <span class="n">fixed_charge</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_electric_usage_kwh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.model.calculate_gas_fixed_charge_per_user" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_gas_fixed_charge_per_user</span><span class="p">(</span><span class="n">fixed_charge</span><span class="p">)</span></code>

<a href="#npa_howtopay.model.calculate_gas_fixed_charge_per_user" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return gas fixed cost per user. Currently a user defined constant</p>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_gas_fixed_charge_per_user</span><span class="p">(</span><span class="n">fixed_charge</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return gas fixed cost per user. Currently a user defined constant&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">fixed_charge</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.model.calculate_gas_variable_tariff_per_therm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_gas_variable_tariff_per_therm</span><span class="p">(</span><span class="n">gas_infl_adj_revenue</span><span class="p">,</span> <span class="n">total_gas_usage_therms</span><span class="p">,</span> <span class="n">fixed_charge</span><span class="p">,</span> <span class="n">num_users</span><span class="p">)</span></code>

<a href="#npa_howtopay.model.calculate_gas_variable_tariff_per_therm" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calculate gas variable cost per therm.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gas_infl_adj_revenue</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total gas revenue adjusted for inflation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_gas_usage_therms</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total gas usage in therms</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fixed_charge</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fixed charge per user</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_users</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of users</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variable cost per therm calculated by subtracting total fixed charges
  from revenue and dividing by total usage</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_gas_variable_tariff_per_therm</span><span class="p">(</span>
    <span class="n">gas_infl_adj_revenue</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">total_gas_usage_therms</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">fixed_charge</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">num_users</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate gas variable cost per therm.</span>

<span class="sd">    Args:</span>
<span class="sd">        gas_infl_adj_revenue: Total gas revenue adjusted for inflation</span>
<span class="sd">        total_gas_usage_therms: Total gas usage in therms</span>
<span class="sd">        fixed_charge: Fixed charge per user</span>
<span class="sd">        num_users: Number of users</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Variable cost per therm calculated by subtracting total fixed charges</span>
<span class="sd">              from revenue and dividing by total usage</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">gas_infl_adj_revenue</span> <span class="o">-</span> <span class="n">num_users</span> <span class="o">*</span> <span class="n">fixed_charge</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_gas_usage_therms</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.model.calculate_nonconverts_electric_bill_per_user" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_nonconverts_electric_bill_per_user</span><span class="p">(</span><span class="n">electric_fixed_charge</span><span class="p">,</span> <span class="n">electric_variable_tariff</span><span class="p">,</span> <span class="n">per_user_electric_need</span><span class="p">)</span></code>

<a href="#npa_howtopay.model.calculate_nonconverts_electric_bill_per_user" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calculate electric bill per user for nonconverts (no heating).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>electric_fixed_charge</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fixed charge per user</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>electric_variable_tariff</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variable tariff per kWh</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>per_user_electric_need</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Electric need per user</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Electric bill per user for nonconverts</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_nonconverts_electric_bill_per_user</span><span class="p">(</span>
    <span class="n">electric_fixed_charge</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">electric_variable_tariff</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">per_user_electric_need</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate electric bill per user for nonconverts (no heating).</span>

<span class="sd">    Args:</span>
<span class="sd">        electric_fixed_charge: Fixed charge per user</span>
<span class="sd">        electric_variable_tariff: Variable tariff per kWh</span>
<span class="sd">        per_user_electric_need: Electric need per user</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Electric bill per user for nonconverts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">electric_fixed_charge</span> <span class="o">+</span> <span class="n">electric_variable_tariff</span> <span class="o">*</span> <span class="n">per_user_electric_need</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.model.calculate_nonconverts_gas_bill_per_user" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_nonconverts_gas_bill_per_user</span><span class="p">(</span><span class="n">gas_fixed_charge</span><span class="p">,</span> <span class="n">gas_variable_tariff</span><span class="p">,</span> <span class="n">per_user_heating_need</span><span class="p">)</span></code>

<a href="#npa_howtopay.model.calculate_nonconverts_gas_bill_per_user" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calculate gas bill per user for nonconverts.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gas_fixed_charge</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fixed charge per user</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gas_variable_tariff</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variable tariff per therm</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>per_user_heating_need</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Heating need per user</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Gas bill per user for nonconverts</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_nonconverts_gas_bill_per_user</span><span class="p">(</span>
    <span class="n">gas_fixed_charge</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">gas_variable_tariff</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">per_user_heating_need</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate gas bill per user for nonconverts.</span>

<span class="sd">    Args:</span>
<span class="sd">        gas_fixed_charge: Fixed charge per user</span>
<span class="sd">        gas_variable_tariff: Variable tariff per therm</span>
<span class="sd">        per_user_heating_need: Heating need per user</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Gas bill per user for nonconverts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">gas_fixed_charge</span> <span class="o">+</span> <span class="n">gas_variable_tariff</span> <span class="o">*</span> <span class="n">per_user_heating_need</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.model.calculate_nonconverts_total_bill_per_user" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_nonconverts_total_bill_per_user</span><span class="p">(</span><span class="n">nonconverts_gas_bill</span><span class="p">,</span> <span class="n">nonconverts_electric_bill</span><span class="p">)</span></code>

<a href="#npa_howtopay.model.calculate_nonconverts_total_bill_per_user" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calculate total bill per user for nonconverts (gas + electric).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>nonconverts_gas_bill</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Gas bill per user for nonconverts</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nonconverts_electric_bill</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Electric bill per user for nonconverts</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total bill per user for nonconverts</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_nonconverts_total_bill_per_user</span><span class="p">(</span><span class="n">nonconverts_gas_bill</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nonconverts_electric_bill</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate total bill per user for nonconverts (gas + electric).</span>

<span class="sd">    Args:</span>
<span class="sd">        nonconverts_gas_bill: Gas bill per user for nonconverts</span>
<span class="sd">        nonconverts_electric_bill: Electric bill per user for nonconverts</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Total bill per user for nonconverts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">nonconverts_gas_bill</span> <span class="o">+</span> <span class="n">nonconverts_electric_bill</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.model.compute_bill_costs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_bill_costs</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">input_params</span><span class="p">)</span></code>

<a href="#npa_howtopay.model.compute_bill_costs" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute bill costs and tariffs for gas and electric utilities.</p>
<p>Takes a DataFrame with revenue requirements and usage data and computes:
- Inflation adjusted revenue requirements for gas and electric
- Fixed charges per user and Variable tariffs per therm (gas) and kWh (electric)
- Utility bills per user for converts and nonconverts
- Total bills per user for converts and nonconverts</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing revenue requirements and usage data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>input_params</code>
            </td>
            <td>
                  <code><span title="npa_howtopay.params.InputParams">InputParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input parameters containing utility rates and user counts</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame with added columns for adjusted revenue requirements and tariffs</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_bill_costs</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">input_params</span><span class="p">:</span> <span class="n">InputParams</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute bill costs and tariffs for gas and electric utilities.</span>

<span class="sd">    Takes a DataFrame with revenue requirements and usage data and computes:</span>
<span class="sd">    - Inflation adjusted revenue requirements for gas and electric</span>
<span class="sd">    - Fixed charges per user and Variable tariffs per therm (gas) and kWh (electric)</span>
<span class="sd">    - Utility bills per user for converts and nonconverts</span>
<span class="sd">    - Total bills per user for converts and nonconverts</span>

<span class="sd">    Args:</span>
<span class="sd">        df: DataFrame containing revenue requirements and usage data</span>
<span class="sd">        input_params: Input parameters containing utility rates and user counts</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame with added columns for adjusted revenue requirements and tariffs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start_year</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

    <span class="c1"># Create inflation-adjusted revenue requirement columns</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">([</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">struct</span><span class="p">([</span><span class="s2">&quot;gas_revenue_requirement&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">map_elements</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">inflation_adjust_revenue_requirement</span><span class="p">(</span>
                <span class="n">x</span><span class="p">[</span><span class="s2">&quot;gas_revenue_requirement&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">input_params</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">real_dollar_discount_rate</span>
            <span class="p">),</span>
            <span class="n">return_dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;gas_inflation_adjusted_revenue_requirement&quot;</span><span class="p">),</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">struct</span><span class="p">([</span><span class="s2">&quot;electric_revenue_requirement&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">map_elements</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">inflation_adjust_revenue_requirement</span><span class="p">(</span>
                <span class="n">x</span><span class="p">[</span><span class="s2">&quot;electric_revenue_requirement&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">input_params</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">real_dollar_discount_rate</span>
            <span class="p">),</span>
            <span class="n">return_dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;electric_inflation_adjusted_revenue_requirement&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;gas_revenue_requirement&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;electric_revenue_requirement&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;total_revenue_requirement&quot;</span><span class="p">),</span>
    <span class="p">])</span>

    <span class="c1"># Create gas and electric tariffs columns (and total inflation adjusted revenue requirement)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">([</span>
        <span class="p">(</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;gas_inflation_adjusted_revenue_requirement&quot;</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;electric_inflation_adjusted_revenue_requirement&quot;</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;total_inflation_adjusted_revenue_requirement&quot;</span><span class="p">),</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">struct</span><span class="p">([</span><span class="s2">&quot;gas_inflation_adjusted_revenue_requirement&quot;</span><span class="p">,</span> <span class="s2">&quot;total_gas_usage_therms&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">map_elements</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">calculate_gas_variable_tariff_per_therm</span><span class="p">(</span>
                <span class="n">x</span><span class="p">[</span><span class="s2">&quot;gas_inflation_adjusted_revenue_requirement&quot;</span><span class="p">],</span>
                <span class="n">x</span><span class="p">[</span><span class="s2">&quot;total_gas_usage_therms&quot;</span><span class="p">],</span>
                <span class="n">input_params</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">user_bill_fixed_charge</span><span class="p">,</span>
                <span class="n">input_params</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">num_users_init</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">return_dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;gas_variable_tariff_per_therm&quot;</span><span class="p">),</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">struct</span><span class="p">([</span><span class="s2">&quot;electric_inflation_adjusted_revenue_requirement&quot;</span><span class="p">,</span> <span class="s2">&quot;total_electric_usage_kwh&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">map_elements</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">calculate_electric_variable_tariff_per_kwh</span><span class="p">(</span>
                <span class="n">x</span><span class="p">[</span><span class="s2">&quot;electric_inflation_adjusted_revenue_requirement&quot;</span><span class="p">],</span>
                <span class="n">x</span><span class="p">[</span><span class="s2">&quot;total_electric_usage_kwh&quot;</span><span class="p">],</span>
                <span class="n">input_params</span><span class="o">.</span><span class="n">electric</span><span class="o">.</span><span class="n">user_bill_fixed_charge</span><span class="p">,</span>
                <span class="n">input_params</span><span class="o">.</span><span class="n">electric</span><span class="o">.</span><span class="n">num_users_init</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">return_dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;electric_variable_tariff_per_kwh&quot;</span><span class="p">),</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span>
            <span class="n">calculate_electric_fixed_charge_per_user</span><span class="p">(</span>
                <span class="n">input_params</span><span class="o">.</span><span class="n">electric</span><span class="o">.</span><span class="n">user_bill_fixed_charge</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;electric_fixed_charge_per_user&quot;</span><span class="p">),</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span>
            <span class="n">calculate_gas_fixed_charge_per_user</span><span class="p">(</span>
                <span class="n">input_params</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">user_bill_fixed_charge</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;gas_fixed_charge_per_user&quot;</span><span class="p">),</span>
    <span class="p">])</span>

    <span class="c1"># Create per-user gas bill columns and total inflation adjusted revenue requirement</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">([</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">struct</span><span class="p">([</span><span class="s2">&quot;gas_inflation_adjusted_revenue_requirement&quot;</span><span class="p">,</span> <span class="s2">&quot;gas_num_users&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">map_elements</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">calculate_avg_bill_per_user</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;gas_inflation_adjusted_revenue_requirement&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;gas_num_users&quot;</span><span class="p">]),</span>
            <span class="n">return_dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;gas_avg_bill_per_user&quot;</span><span class="p">),</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">struct</span><span class="p">([</span><span class="s2">&quot;gas_fixed_charge_per_user&quot;</span><span class="p">,</span> <span class="s2">&quot;gas_variable_tariff_per_therm&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">map_elements</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">calculate_nonconverts_gas_bill_per_user</span><span class="p">(</span>
                <span class="n">x</span><span class="p">[</span><span class="s2">&quot;gas_fixed_charge_per_user&quot;</span><span class="p">],</span>
                <span class="n">x</span><span class="p">[</span><span class="s2">&quot;gas_variable_tariff_per_therm&quot;</span><span class="p">],</span>
                <span class="n">input_params</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">per_user_heating_need_therms</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">return_dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;gas_nonconverts_bill_per_user&quot;</span><span class="p">),</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;gas_converts_bill_per_user&quot;</span><span class="p">),</span>
    <span class="p">])</span>

    <span class="c1"># Create converts and nonconverts electric bills</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">([</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">struct</span><span class="p">([</span><span class="s2">&quot;electric_inflation_adjusted_revenue_requirement&quot;</span><span class="p">,</span> <span class="s2">&quot;electric_num_users&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">map_elements</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">calculate_avg_bill_per_user</span><span class="p">(</span>
                <span class="n">x</span><span class="p">[</span><span class="s2">&quot;electric_inflation_adjusted_revenue_requirement&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;electric_num_users&quot;</span><span class="p">]</span>
            <span class="p">),</span>
            <span class="n">return_dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;electric_avg_bill_per_user&quot;</span><span class="p">),</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">struct</span><span class="p">([</span><span class="s2">&quot;electric_fixed_charge_per_user&quot;</span><span class="p">,</span> <span class="s2">&quot;electric_variable_tariff_per_kwh&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">map_elements</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">calculate_converts_electric_bill_per_user</span><span class="p">(</span>
                <span class="n">x</span><span class="p">[</span><span class="s2">&quot;electric_fixed_charge_per_user&quot;</span><span class="p">],</span>
                <span class="n">x</span><span class="p">[</span><span class="s2">&quot;electric_variable_tariff_per_kwh&quot;</span><span class="p">],</span>
                <span class="n">input_params</span><span class="o">.</span><span class="n">electric</span><span class="o">.</span><span class="n">per_user_electric_need_kwh</span><span class="p">,</span>
                <span class="n">input_params</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">per_user_heating_need_therms</span><span class="p">,</span>
                <span class="n">input_params</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">per_user_water_heating_need_therms</span><span class="p">,</span>
                <span class="n">input_params</span><span class="o">.</span><span class="n">electric</span><span class="o">.</span><span class="n">hp_efficiency</span><span class="p">,</span>
                <span class="n">input_params</span><span class="o">.</span><span class="n">electric</span><span class="o">.</span><span class="n">water_heater_efficiency</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">return_dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;electric_converts_bill_per_user&quot;</span><span class="p">),</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">struct</span><span class="p">([</span><span class="s2">&quot;electric_fixed_charge_per_user&quot;</span><span class="p">,</span> <span class="s2">&quot;electric_variable_tariff_per_kwh&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">map_elements</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">calculate_nonconverts_electric_bill_per_user</span><span class="p">(</span>
                <span class="n">x</span><span class="p">[</span><span class="s2">&quot;electric_fixed_charge_per_user&quot;</span><span class="p">],</span>
                <span class="n">x</span><span class="p">[</span><span class="s2">&quot;electric_variable_tariff_per_kwh&quot;</span><span class="p">],</span>
                <span class="n">input_params</span><span class="o">.</span><span class="n">electric</span><span class="o">.</span><span class="n">per_user_electric_need_kwh</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">return_dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;electric_nonconverts_bill_per_user&quot;</span><span class="p">),</span>
    <span class="p">])</span>

    <span class="c1"># Create total bill calculations for converts and nonconverts</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">([</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">struct</span><span class="p">([</span><span class="s2">&quot;gas_converts_bill_per_user&quot;</span><span class="p">,</span> <span class="s2">&quot;electric_converts_bill_per_user&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">map_elements</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">calculate_converts_total_bill_per_user</span><span class="p">(</span>
                <span class="n">x</span><span class="p">[</span><span class="s2">&quot;gas_converts_bill_per_user&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;electric_converts_bill_per_user&quot;</span><span class="p">]</span>
            <span class="p">),</span>
            <span class="n">return_dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;converts_total_bill_per_user&quot;</span><span class="p">),</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">struct</span><span class="p">([</span><span class="s2">&quot;gas_nonconverts_bill_per_user&quot;</span><span class="p">,</span> <span class="s2">&quot;electric_nonconverts_bill_per_user&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">map_elements</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">calculate_nonconverts_total_bill_per_user</span><span class="p">(</span>
                <span class="n">x</span><span class="p">[</span><span class="s2">&quot;gas_nonconverts_bill_per_user&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;electric_nonconverts_bill_per_user&quot;</span><span class="p">]</span>
            <span class="p">),</span>
            <span class="n">return_dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;nonconverts_total_bill_per_user&quot;</span><span class="p">),</span>
    <span class="p">])</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.model.compute_intermediate_cols_electric" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_intermediate_cols_electric</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">input_params</span><span class="p">,</span> <span class="n">ts_params</span><span class="p">)</span></code>

<a href="#npa_howtopay.model.compute_intermediate_cols_electric" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute intermediate columns for electric utility calculations.</p>
<p>Calculates electric utility metrics for a given year including:
- Number of users and cumulative heat pump converts
- Total electric usage in kWh (base usage + heating from converts)
- Fixed and volumetric costs
- Operating expenses and revenue requirements</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="YearContext


  
      dataclass
   (npa_howtopay.model.YearContext)" href="#npa_howtopay.model.YearContext">YearContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Year context containing ratebase, depreciation and maintenance costs</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>input_params</code>
            </td>
            <td>
                  <code><span title="npa_howtopay.params.InputParams">InputParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input parameters with utility rates and user counts</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ts_params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="TimeSeriesParams (npa_howtopay.params.TimeSeriesParams)" href="#npa_howtopay.params.TimeSeriesParams">TimeSeriesParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time series parameters with NPA projects and overhead costs</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame with calculated electric utility metrics for the given year</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_intermediate_cols_electric</span><span class="p">(</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">YearContext</span><span class="p">,</span> <span class="n">input_params</span><span class="p">:</span> <span class="n">InputParams</span><span class="p">,</span> <span class="n">ts_params</span><span class="p">:</span> <span class="n">TimeSeriesParams</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute intermediate columns for electric utility calculations.</span>

<span class="sd">    Calculates electric utility metrics for a given year including:</span>
<span class="sd">    - Number of users and cumulative heat pump converts</span>
<span class="sd">    - Total electric usage in kWh (base usage + heating from converts)</span>
<span class="sd">    - Fixed and volumetric costs</span>
<span class="sd">    - Operating expenses and revenue requirements</span>

<span class="sd">    Args:</span>
<span class="sd">        context: Year context containing ratebase, depreciation and maintenance costs</span>
<span class="sd">        input_params: Input parameters with utility rates and user counts</span>
<span class="sd">        ts_params: Time series parameters with NPA projects and overhead costs</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame with calculated electric utility metrics for the given year</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">electric_fixed_overhead_costs</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ts_params</span><span class="o">.</span><span class="n">electric_fixed_overhead_costs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">context</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cost&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">total_converts_cumul</span> <span class="o">=</span> <span class="n">npa</span><span class="o">.</span><span class="n">compute_hp_converts_from_df</span><span class="p">(</span>
        <span class="n">context</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">ts_params</span><span class="o">.</span><span class="n">npa_projects</span><span class="p">,</span> <span class="n">cumulative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">npa_only</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">electric_num_users</span> <span class="o">=</span> <span class="n">input_params</span><span class="o">.</span><span class="n">electric</span><span class="o">.</span><span class="n">num_users_init</span>
    <span class="n">added_usage</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">total_converts_cumul</span>
        <span class="o">*</span> <span class="n">input_params</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">per_user_heating_need_therms</span>
        <span class="o">*</span> <span class="n">KWH_PER_THERM</span>
        <span class="o">/</span> <span class="n">input_params</span><span class="o">.</span><span class="n">electric</span><span class="o">.</span><span class="n">hp_efficiency</span>
        <span class="o">+</span> <span class="n">total_converts_cumul</span>
        <span class="o">*</span> <span class="n">input_params</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">per_user_water_heating_need_therms</span>
        <span class="o">*</span> <span class="n">KWH_PER_THERM</span>
        <span class="o">/</span> <span class="n">input_params</span><span class="o">.</span><span class="n">electric</span><span class="o">.</span><span class="n">water_heater_efficiency</span>
    <span class="p">)</span>
    <span class="n">total_usage</span> <span class="o">=</span> <span class="n">input_params</span><span class="o">.</span><span class="n">electric</span><span class="o">.</span><span class="n">num_users_init</span> <span class="o">*</span> <span class="n">input_params</span><span class="o">.</span><span class="n">electric</span><span class="o">.</span><span class="n">per_user_electric_need_kwh</span> <span class="o">+</span> <span class="n">added_usage</span>
    <span class="n">costs_volumetric</span> <span class="o">=</span> <span class="n">total_usage</span> <span class="o">*</span> <span class="n">input_params</span><span class="o">.</span><span class="n">electric</span><span class="o">.</span><span class="n">electricity_generation_cost_per_kwh</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
    <span class="n">costs_fixed</span> <span class="o">=</span> <span class="n">electric_fixed_overhead_costs</span> <span class="o">+</span> <span class="n">context</span><span class="o">.</span><span class="n">electric_maintenance_cost</span> <span class="o">+</span> <span class="n">context</span><span class="o">.</span><span class="n">electric_npa_opex</span>
    <span class="n">opex_costs</span> <span class="o">=</span> <span class="n">costs_fixed</span> <span class="o">+</span> <span class="n">costs_volumetric</span>
    <span class="n">revenue_requirement</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">context</span><span class="o">.</span><span class="n">electric_ratebase</span> <span class="o">*</span> <span class="n">input_params</span><span class="o">.</span><span class="n">electric</span><span class="o">.</span><span class="n">ror</span> <span class="o">+</span> <span class="n">opex_costs</span> <span class="o">+</span> <span class="n">context</span><span class="o">.</span><span class="n">electric_depreciation_expense</span>
    <span class="p">)</span>
    <span class="n">return_on_ratebase_pct</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">context</span><span class="o">.</span><span class="n">electric_ratebase</span> <span class="o">*</span> <span class="n">input_params</span><span class="o">.</span><span class="n">electric</span><span class="o">.</span><span class="n">ror</span>
    <span class="p">)</span> <span class="o">/</span> <span class="n">revenue_requirement</span>  <span class="c1"># Return on Rate Base as % of Revenue Requirement</span>

    <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">context</span><span class="o">.</span><span class="n">year</span><span class="p">],</span>
        <span class="s2">&quot;electric_num_users&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">electric_num_users</span><span class="p">],</span>
        <span class="s2">&quot;total_converts_cumul&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">total_converts_cumul</span><span class="p">],</span>
        <span class="s2">&quot;electric_added_usage_kwh&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">added_usage</span><span class="p">],</span>
        <span class="s2">&quot;total_electric_usage_kwh&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">total_usage</span><span class="p">],</span>
        <span class="s2">&quot;electric_costs_volumetric&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">costs_volumetric</span><span class="p">],</span>
        <span class="s2">&quot;electric_costs_fixed&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">costs_fixed</span><span class="p">],</span>
        <span class="s2">&quot;electric_opex_costs&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">opex_costs</span><span class="p">],</span>
        <span class="s2">&quot;electric_revenue_requirement&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">revenue_requirement</span><span class="p">],</span>
        <span class="s2">&quot;electric_return_on_ratebase_pct&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">return_on_ratebase_pct</span><span class="p">],</span>
    <span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.model.compute_intermediate_cols_gas" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_intermediate_cols_gas</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">input_params</span><span class="p">,</span> <span class="n">ts_params</span><span class="p">)</span></code>

<a href="#npa_howtopay.model.compute_intermediate_cols_gas" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute intermediate columns for gas utility calculations.</p>
<p>Calculates gas utility metrics for a given year including:
- Number of users (accounting for heat pump converts)
- Total gas usage in therms
- Fixed and volumetric costs
- Operating expenses and revenue requirements</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="YearContext


  
      dataclass
   (npa_howtopay.model.YearContext)" href="#npa_howtopay.model.YearContext">YearContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Year context containing ratebase, depreciation and maintenance costs</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>input_params</code>
            </td>
            <td>
                  <code><span title="npa_howtopay.params.InputParams">InputParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input parameters with utility rates and user counts</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ts_params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="TimeSeriesParams (npa_howtopay.params.TimeSeriesParams)" href="#npa_howtopay.params.TimeSeriesParams">TimeSeriesParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time series parameters with NPA projects and overhead costs</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame with calculated gas utility metrics for the given year</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_intermediate_cols_gas</span><span class="p">(</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">YearContext</span><span class="p">,</span> <span class="n">input_params</span><span class="p">:</span> <span class="n">InputParams</span><span class="p">,</span> <span class="n">ts_params</span><span class="p">:</span> <span class="n">TimeSeriesParams</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute intermediate columns for gas utility calculations.</span>

<span class="sd">    Calculates gas utility metrics for a given year including:</span>
<span class="sd">    - Number of users (accounting for heat pump converts)</span>
<span class="sd">    - Total gas usage in therms</span>
<span class="sd">    - Fixed and volumetric costs</span>
<span class="sd">    - Operating expenses and revenue requirements</span>

<span class="sd">    Args:</span>
<span class="sd">        context: Year context containing ratebase, depreciation and maintenance costs</span>
<span class="sd">        input_params: Input parameters with utility rates and user counts</span>
<span class="sd">        ts_params: Time series parameters with NPA projects and overhead costs</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame with calculated gas utility metrics for the given year</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gas_fixed_overhead_costs</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ts_params</span><span class="o">.</span><span class="n">gas_fixed_overhead_costs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">context</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cost&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">gas_num_users</span> <span class="o">=</span> <span class="n">input_params</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">num_users_init</span> <span class="o">-</span> <span class="n">npa</span><span class="o">.</span><span class="n">compute_hp_converts_from_df</span><span class="p">(</span>
        <span class="n">context</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">ts_params</span><span class="o">.</span><span class="n">npa_projects</span><span class="p">,</span> <span class="n">cumulative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">npa_only</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">total_usage</span> <span class="o">=</span> <span class="n">gas_num_users</span> <span class="o">*</span> <span class="n">input_params</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">per_user_heating_need_therms</span>
    <span class="n">costs_volumetric</span> <span class="o">=</span> <span class="n">total_usage</span> <span class="o">*</span> <span class="n">input_params</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">gas_generation_cost_per_therm</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
    <span class="n">costs_fixed</span> <span class="o">=</span> <span class="n">gas_fixed_overhead_costs</span> <span class="o">+</span> <span class="n">context</span><span class="o">.</span><span class="n">gas_maintenance_cost</span> <span class="o">+</span> <span class="n">context</span><span class="o">.</span><span class="n">gas_npa_opex</span>
    <span class="n">opex_costs</span> <span class="o">=</span> <span class="n">costs_fixed</span> <span class="o">+</span> <span class="n">costs_volumetric</span>
    <span class="n">revenue_requirement</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">context</span><span class="o">.</span><span class="n">gas_ratebase</span> <span class="o">*</span> <span class="n">input_params</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">ror</span>
        <span class="o">+</span> <span class="n">opex_costs</span>
        <span class="o">+</span> <span class="n">context</span><span class="o">.</span><span class="n">gas_depreciation_expense</span>
        <span class="o">+</span> <span class="n">context</span><span class="o">.</span><span class="n">gas_performance_incentive</span>
    <span class="p">)</span>
    <span class="n">return_on_ratebase_pct</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">context</span><span class="o">.</span><span class="n">gas_ratebase</span> <span class="o">*</span> <span class="n">input_params</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">ror</span>
    <span class="p">)</span> <span class="o">/</span> <span class="n">revenue_requirement</span>  <span class="c1"># Return on Rate Base as % of Revenue Requirement</span>

    <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">context</span><span class="o">.</span><span class="n">year</span><span class="p">],</span>
        <span class="s2">&quot;gas_num_users&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">gas_num_users</span><span class="p">],</span>
        <span class="s2">&quot;total_gas_usage_therms&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">total_usage</span><span class="p">],</span>
        <span class="s2">&quot;gas_costs_volumetric&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">costs_volumetric</span><span class="p">],</span>
        <span class="s2">&quot;gas_costs_fixed&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">costs_fixed</span><span class="p">],</span>
        <span class="s2">&quot;gas_opex_costs&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">opex_costs</span><span class="p">],</span>
        <span class="s2">&quot;gas_revenue_requirement&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">revenue_requirement</span><span class="p">],</span>
        <span class="s2">&quot;gas_return_on_ratebase_pct&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">return_on_ratebase_pct</span><span class="p">],</span>
    <span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.model.create_scenario_runs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_scenario_runs</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="p">,</span> <span class="n">gas_electric</span><span class="p">,</span> <span class="n">capex_opex</span><span class="p">)</span></code>

<a href="#npa_howtopay.model.create_scenario_runs" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a dictionary of scenario parameters for different model runs.</p>
<p>Creates scenarios for business-as-usual (BAU), taxpayer-funded, and combinations of
gas/electric and capex/opex interventions. Each scenario specifies the time period
and configuration parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>start_year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>First year of the scenario analysis</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Last year of the scenario analysis</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gas_electric</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="typing.Literal">Literal</span>[&#39;gas&#39;, &#39;electric&#39;]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List specifying which utilities to analyze ("gas" and/or "electric")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>capex_opex</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="typing.Literal">Literal</span>[&#39;capex&#39;, &#39;opex&#39;]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List specifying which cost types to analyze ("capex" and/or "opex")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="npa_howtopay.params.ScenarioParams">ScenarioParams</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary mapping scenario names to ScenarioParams objects containing the</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="npa_howtopay.params.ScenarioParams">ScenarioParams</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>configuration for that scenario. Includes "bau" and "taxpayer" base scenarios</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="npa_howtopay.params.ScenarioParams">ScenarioParams</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>plus combinations of gas/electric and capex/opex parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_scenario_runs</span><span class="p">(</span>
    <span class="n">start_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">end_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">gas_electric</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;electric&quot;</span><span class="p">]],</span>
    <span class="n">capex_opex</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;capex&quot;</span><span class="p">,</span> <span class="s2">&quot;opex&quot;</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ScenarioParams</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a dictionary of scenario parameters for different model runs.</span>

<span class="sd">    Creates scenarios for business-as-usual (BAU), taxpayer-funded, and combinations of</span>
<span class="sd">    gas/electric and capex/opex interventions. Each scenario specifies the time period</span>
<span class="sd">    and configuration parameters.</span>

<span class="sd">    Args:</span>
<span class="sd">        start_year: First year of the scenario analysis</span>
<span class="sd">        end_year: Last year of the scenario analysis</span>
<span class="sd">        gas_electric: List specifying which utilities to analyze (&quot;gas&quot; and/or &quot;electric&quot;)</span>
<span class="sd">        capex_opex: List specifying which cost types to analyze (&quot;capex&quot; and/or &quot;opex&quot;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary mapping scenario names to ScenarioParams objects containing the</span>
<span class="sd">        configuration for that scenario. Includes &quot;bau&quot; and &quot;taxpayer&quot; base scenarios</span>
<span class="sd">        plus combinations of gas/electric and capex/opex parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scenarios</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;bau&quot;</span><span class="p">:</span> <span class="n">ScenarioParams</span><span class="p">(</span><span class="n">start_year</span><span class="o">=</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="o">=</span><span class="n">end_year</span><span class="p">,</span> <span class="n">bau</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s2">&quot;taxpayer&quot;</span><span class="p">:</span> <span class="n">ScenarioParams</span><span class="p">(</span><span class="n">start_year</span><span class="o">=</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="o">=</span><span class="n">end_year</span><span class="p">,</span> <span class="n">taxpayer</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s2">&quot;performance_incentive&quot;</span><span class="p">:</span> <span class="n">ScenarioParams</span><span class="p">(</span>
            <span class="n">start_year</span><span class="o">=</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="o">=</span><span class="n">end_year</span><span class="p">,</span> <span class="n">performance_incentive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gas_electric</span><span class="o">=</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="n">capex_opex</span><span class="o">=</span><span class="s2">&quot;opex&quot;</span>
        <span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># Add the regular scenarios</span>
    <span class="k">for</span> <span class="n">ge</span> <span class="ow">in</span> <span class="n">gas_electric</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">co</span> <span class="ow">in</span> <span class="n">capex_opex</span><span class="p">:</span>
            <span class="n">scenarios</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ge</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">co</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ScenarioParams</span><span class="p">(</span>
                <span class="n">start_year</span><span class="o">=</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="o">=</span><span class="n">end_year</span><span class="p">,</span> <span class="n">gas_electric</span><span class="o">=</span><span class="n">ge</span><span class="p">,</span> <span class="n">capex_opex</span><span class="o">=</span><span class="n">co</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">scenarios</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.model.inflation_adjust_revenue_requirement" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">inflation_adjust_revenue_requirement</span><span class="p">(</span><span class="n">revenue_req</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">real_dollar_discount_rate</span><span class="p">)</span></code>

<a href="#npa_howtopay.model.inflation_adjust_revenue_requirement" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Adjust revenue requirement for inflation using discount rate.</p>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">inflation_adjust_revenue_requirement</span><span class="p">(</span>
    <span class="n">revenue_req</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">start_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">real_dollar_discount_rate</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adjust revenue requirement for inflation using discount rate.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="n">start_year</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Year </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> cannot be before start year </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">revenue_req</span> <span class="o">/</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">real_dollar_discount_rate</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">year</span> <span class="o">-</span> <span class="n">start_year</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="npa_howtopay.params" class="doc doc-heading">
            <code>npa_howtopay.params</code>


<a href="#npa_howtopay.params" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="npa_howtopay.params.TimeSeriesParams" class="doc doc-heading">
            <code>TimeSeriesParams</code>


<a href="#npa_howtopay.params.TimeSeriesParams" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">








              <details class="quote">
                <summary>Source code in <code>src/npa_howtopay/params.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@define</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TimeSeriesParams</span><span class="p">:</span>
    <span class="n">npa_projects</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span>
    <span class="n">scattershot_electrification</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span>
    <span class="n">gas_fixed_overhead_costs</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span>
    <span class="n">electric_fixed_overhead_costs</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span>
    <span class="n">gas_bau_lpp_costs_per_year</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__attrs_post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Automatically append scattershot electrification to npa projects. In the BAU scenario, this will only return the scattershot electrification dataframe.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">npa_projects</span> <span class="o">=</span> <span class="n">append_scattershot_electrification_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npa_projects</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattershot_electrification</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="npa_howtopay.params.TimeSeriesParams.__attrs_post_init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__attrs_post_init__</span><span class="p">()</span></code>

<a href="#npa_howtopay.params.TimeSeriesParams.__attrs_post_init__" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Automatically append scattershot electrification to npa projects. In the BAU scenario, this will only return the scattershot electrification dataframe.</p>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/params.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__attrs_post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Automatically append scattershot electrification to npa projects. In the BAU scenario, this will only return the scattershot electrification dataframe.&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">npa_projects</span> <span class="o">=</span> <span class="n">append_scattershot_electrification_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npa_projects</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattershot_electrification</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.params.get_available_runs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_available_runs</span><span class="p">(</span><span class="n">data_dir</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span></code>

<a href="#npa_howtopay.params.get_available_runs" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get list of available run_names from YAML files</p>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/params.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_available_runs</span><span class="p">(</span><span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of available run_names from YAML files&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>

    <span class="n">yaml_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_dir</span><span class="si">}</span><span class="s2">/*.yaml&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">yaml_files</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.params.load_scenario_from_yaml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_scenario_from_yaml</span><span class="p">(</span><span class="n">run_name</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span></code>

<a href="#npa_howtopay.params.load_scenario_from_yaml" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Load default parameters for a specific run_name from its YAML file</p>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/params.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_scenario_from_yaml</span><span class="p">(</span><span class="n">run_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InputParams</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load default parameters for a specific run_name from its YAML file&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

    <span class="c1"># Get the package directory</span>
    <span class="n">package_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
    <span class="n">yaml_path</span> <span class="o">=</span> <span class="n">package_dir</span> <span class="o">/</span> <span class="n">data_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">run_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>

    <span class="k">return</span> <span class="n">_load_params_from_yaml</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.params.load_time_series_params_from_web_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_time_series_params_from_web_params</span><span class="p">(</span><span class="n">web_params</span><span class="p">,</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="p">,</span> <span class="n">cost_inflation_rate</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></code>

<a href="#npa_howtopay.params.load_time_series_params_from_web_params" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Load time series parameters from web parameters (scalar values)</p>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/params.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_time_series_params_from_web_params</span><span class="p">(</span>
    <span class="n">web_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">start_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">cost_inflation_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TimeSeriesParams</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load time series parameters from web parameters (scalar values)&quot;&quot;&quot;</span>

    <span class="n">web_params_obj</span> <span class="o">=</span> <span class="n">WebParams</span><span class="p">(</span><span class="o">**</span><span class="n">web_params</span><span class="p">)</span>
    <span class="n">generated_data</span> <span class="o">=</span> <span class="n">create_time_series_from_web_params</span><span class="p">(</span><span class="n">web_params_obj</span><span class="p">,</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="p">,</span> <span class="n">cost_inflation_rate</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">TimeSeriesParams</span><span class="p">(</span>
        <span class="n">npa_projects</span><span class="o">=</span><span class="n">generated_data</span><span class="p">[</span><span class="s2">&quot;npa_projects&quot;</span><span class="p">],</span>
        <span class="n">scattershot_electrification</span><span class="o">=</span><span class="n">generated_data</span><span class="p">[</span><span class="s2">&quot;scattershot_electrification_users_per_year&quot;</span><span class="p">],</span>
        <span class="n">gas_fixed_overhead_costs</span><span class="o">=</span><span class="n">generated_data</span><span class="p">[</span><span class="s2">&quot;gas_fixed_overhead_costs&quot;</span><span class="p">],</span>
        <span class="n">electric_fixed_overhead_costs</span><span class="o">=</span><span class="n">generated_data</span><span class="p">[</span><span class="s2">&quot;electric_fixed_overhead_costs&quot;</span><span class="p">],</span>
        <span class="n">gas_bau_lpp_costs_per_year</span><span class="o">=</span><span class="n">generated_data</span><span class="p">[</span><span class="s2">&quot;gas_bau_lpp_costs_per_year&quot;</span><span class="p">],</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.params.load_time_series_params_from_yaml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_time_series_params_from_yaml</span><span class="p">(</span><span class="n">run_name</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span></code>

<a href="#npa_howtopay.params.load_time_series_params_from_yaml" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Load time series parameters from YAML file</p>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/params.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_time_series_params_from_yaml</span><span class="p">(</span><span class="n">run_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TimeSeriesParams</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load time series parameters from YAML file&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

    <span class="c1"># Get the package directory</span>
    <span class="n">package_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
    <span class="n">yaml_path</span> <span class="o">=</span> <span class="n">package_dir</span> <span class="o">/</span> <span class="n">data_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">run_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>

    <span class="k">return</span> <span class="n">_load_time_series_params_from_yaml</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="npa_howtopay.capex_project" class="doc doc-heading">
            <code>npa_howtopay.capex_project</code>


<a href="#npa_howtopay.capex_project" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="npa_howtopay.capex_project.NpvSavingsProject" class="doc doc-heading">
            <code>NpvSavingsProject</code>


<a href="#npa_howtopay.capex_project.NpvSavingsProject" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">


        <p>Represents NPV savings from NPA projects that generate performance incentives.</p>







              <details class="quote">
                <summary>Source code in <code>src/npa_howtopay/capex_project.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@define</span>
<span class="k">class</span><span class="w"> </span><span class="nc">NpvSavingsProject</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents NPV savings from NPA projects that generate performance incentives.&quot;&quot;&quot;</span>

    <span class="n">project_year</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">()</span>
    <span class="n">savings_amount</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">validators</span><span class="o">.</span><span class="n">ge</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
    <span class="n">payback_period</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">validators</span><span class="o">.</span><span class="n">ge</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s2">&quot;project_year&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">project_year</span><span class="p">],</span>
            <span class="s2">&quot;savings_amount&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">savings_amount</span><span class="p">],</span>
            <span class="s2">&quot;payback_period&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">payback_period</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Int64</span><span class="p">),</span>
            <span class="s2">&quot;end_year&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">project_year</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">payback_period</span><span class="p">],</span>
        <span class="p">})</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.capex_project.compute_depreciation_expense_from_capex_projects" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_depreciation_expense_from_capex_projects</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span></code>

<a href="#npa_howtopay.capex_project.compute_depreciation_expense_from_capex_projects" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute annual depreciation expense for capital projects.</p>
<p>For each project, depreciation expense is the original cost divided evenly over the depreciation lifetime.
Depreciation starts the year after the project year and continues for the depreciation lifetime.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The year to compute depreciation expense for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing capital projects with columns:
- project_year: int - Year project was initiated
- original_cost: float - Original cost of the project
- depreciation_lifetime: int - Number of years to depreciate over</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total depreciation expense for the year across all projects</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/capex_project.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_depreciation_expense_from_capex_projects</span><span class="p">(</span><span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute annual depreciation expense for capital projects.</span>

<span class="sd">    For each project, depreciation expense is the original cost divided evenly over the depreciation lifetime.</span>
<span class="sd">    Depreciation starts the year after the project year and continues for the depreciation lifetime.</span>

<span class="sd">    Args:</span>
<span class="sd">        year: The year to compute depreciation expense for</span>
<span class="sd">        df: DataFrame containing capital projects with columns:</span>
<span class="sd">            - project_year: int - Year project was initiated</span>
<span class="sd">            - original_cost: float - Original cost of the project</span>
<span class="sd">            - depreciation_lifetime: int - Number of years to depreciate over</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Total depreciation expense for the year across all projects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;project_year&quot;</span><span class="p">))</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;project_year&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;depreciation_lifetime&quot;</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;original_cost&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;depreciation_lifetime&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.capex_project.compute_maintanence_costs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_maintanence_costs</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">maintenance_cost_pct</span><span class="p">)</span></code>

<a href="#npa_howtopay.capex_project.compute_maintanence_costs" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute annual maintenance costs for capital projects.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The year to compute maintenance costs for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing capital projects with columns:
- project_type: str - Type of project (npa or other)
- original_cost: float - Original cost of the project</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>maintenance_cost_pct</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float - Annual maintenance cost as percentage of original cost</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total maintenance costs for the year, excluding NPA projects</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/capex_project.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_maintanence_costs</span><span class="p">(</span><span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">maintenance_cost_pct</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute annual maintenance costs for capital projects.</span>

<span class="sd">    Args:</span>
<span class="sd">        year: The year to compute maintenance costs for</span>
<span class="sd">        df: DataFrame containing capital projects with columns:</span>
<span class="sd">            - project_type: str - Type of project (npa or other)</span>
<span class="sd">            - original_cost: float - Original cost of the project</span>
<span class="sd">        maintenance_cost_pct: float - Annual maintenance cost as percentage of original cost</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Total maintenance costs for the year, excluding NPA projects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;project_type&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;npa&quot;</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;project_year&quot;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">year</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;retirement_year&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">year</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;original_cost&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">*</span> <span class="n">maintenance_cost_pct</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.capex_project.compute_npv_of_capex_investment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_npv_of_capex_investment</span><span class="p">(</span><span class="n">initial_cost</span><span class="p">,</span> <span class="n">lifetime</span><span class="p">,</span> <span class="n">ror</span><span class="p">,</span> <span class="n">real_dollar_discount_rate</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span></code>

<a href="#npa_howtopay.capex_project.compute_npv_of_capex_investment" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute NPV of a capex investment. Year one incurrs a cost, then subsequent years earn a return equal to the ror on the annually depreciated value of the investment.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>initial_cost</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial investment cost</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lifetime</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Investment lifetime in years</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ror</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rate of return on ratebase</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>real_dollar_discount_rate</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Discount rate for NPV</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Year of investment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>NPV of the investment</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/capex_project.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_npv_of_capex_investment</span><span class="p">(</span>
    <span class="n">initial_cost</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lifetime</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ror</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">real_dollar_discount_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute NPV of a capex investment. Year one incurrs a cost, then subsequent years earn a return equal to the ror on the annually depreciated value of the investment.</span>

<span class="sd">    Args:</span>
<span class="sd">        initial_cost: Initial investment cost</span>
<span class="sd">        lifetime: Investment lifetime in years</span>
<span class="sd">        ror: Rate of return on ratebase</span>
<span class="sd">        real_dollar_discount_rate: Discount rate for NPV</span>
<span class="sd">        year: Year of investment</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: NPV of the investment</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">initial_cost</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="c1"># Initial cost (negative cash flow)</span>
    <span class="n">npv</span> <span class="o">=</span> <span class="o">-</span><span class="n">initial_cost</span>

    <span class="c1"># Annual returns over lifetime</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lifetime</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># Annual return = remaining_ratebase_value * ror</span>
        <span class="c1"># Remaining value declines linearly from initial_cost to 0</span>
        <span class="n">remaining_value_fraction</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">lifetime</span><span class="p">)</span>
        <span class="c1"># Return on ratebase</span>
        <span class="n">return_on_ratebase</span> <span class="o">=</span> <span class="n">initial_cost</span> <span class="o">*</span> <span class="n">remaining_value_fraction</span> <span class="o">*</span> <span class="n">ror</span>
        <span class="c1"># Depreciation recovery</span>
        <span class="n">depreciation_recovery</span> <span class="o">=</span> <span class="n">initial_cost</span> <span class="o">/</span> <span class="n">lifetime</span>

        <span class="c1"># Total annual cash flow</span>
        <span class="n">annual_cash_flow</span> <span class="o">=</span> <span class="n">return_on_ratebase</span> <span class="o">+</span> <span class="n">depreciation_recovery</span>

        <span class="c1"># Discount to present value</span>
        <span class="n">discount_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">real_dollar_discount_rate</span><span class="p">)</span> <span class="o">**</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">npv</span> <span class="o">+=</span> <span class="n">annual_cash_flow</span> <span class="o">*</span> <span class="n">discount_factor</span>

    <span class="k">return</span> <span class="n">npv</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.capex_project.compute_npv_savings_from_npa_projects" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_npv_savings_from_npa_projects</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">npa_projects</span><span class="p">,</span> <span class="n">npa_install_cost</span><span class="p">,</span> <span class="n">npa_lifetime</span><span class="p">,</span> <span class="n">pipeline_depreciation_lifetime</span><span class="p">,</span> <span class="n">gas_ror</span><span class="p">,</span> <span class="n">npv_discount_rate</span><span class="p">,</span> <span class="n">performance_incentive_pct</span><span class="p">,</span> <span class="n">incentive_payback_period</span><span class="p">)</span></code>

<a href="#npa_howtopay.capex_project.compute_npv_savings_from_npa_projects" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate NPV savings projects for NPA installations.</p>
<p>This function calculates the NPV difference between NPA investment and avoided LPP spending.
The savings are tracked as projects that generate performance incentives over a payback period.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The year to generate NPV savings projects for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>npa_projects</code>
            </td>
            <td>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing NPA project details</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>npa_install_cost</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cost per household of installing an NPA</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>npa_lifetime</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Expected lifetime in years of an NPA installation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pipeline_depreciation_lifetime</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Depreciation lifetime for avoided pipe projects</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gas_ror</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rate of return on gas utility investments</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>npv_discount_rate</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Discount rate for NPV calculations</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>performance_incentive_pct</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Percentage of savings on which gas utility receives a performance incentive</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    pl.DataFrame with columns:
        - project_year: Year the NPV savings project was initiated
        - savings_amount: Total NPV savings amount
        - payback_period: Number of years to pay incentives
        - end_year: Year the incentive payments end</p>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/capex_project.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_npv_savings_from_npa_projects</span><span class="p">(</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">npa_projects</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">npa_install_cost</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">npa_lifetime</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">pipeline_depreciation_lifetime</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">gas_ror</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">npv_discount_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">performance_incentive_pct</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">incentive_payback_period</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate NPV savings projects for NPA installations.</span>

<span class="sd">    This function calculates the NPV difference between NPA investment and avoided LPP spending.</span>
<span class="sd">    The savings are tracked as projects that generate performance incentives over a payback period.</span>

<span class="sd">    Args:</span>
<span class="sd">        year: The year to generate NPV savings projects for</span>
<span class="sd">        npa_projects: DataFrame containing NPA project details</span>
<span class="sd">        npa_install_cost: Cost per household of installing an NPA</span>
<span class="sd">        npa_lifetime: Expected lifetime in years of an NPA installation</span>
<span class="sd">        pipeline_depreciation_lifetime: Depreciation lifetime for avoided pipe projects</span>
<span class="sd">        gas_ror: Rate of return on gas utility investments</span>
<span class="sd">        npv_discount_rate: Discount rate for NPV calculations</span>
<span class="sd">        performance_incentive_pct: Percentage of savings on which gas utility receives a performance incentive</span>
<span class="sd">    Returns:</span>
<span class="sd">        pl.DataFrame with columns:</span>
<span class="sd">            - project_year: Year the NPV savings project was initiated</span>
<span class="sd">            - savings_amount: Total NPV savings amount</span>
<span class="sd">            - payback_period: Number of years to pay incentives</span>
<span class="sd">            - end_year: Year the incentive payments end</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">npas_this_year</span> <span class="o">=</span> <span class="n">npa_projects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;project_year&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">year</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">npas_this_year</span><span class="o">.</span><span class="n">height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">return_empty_npv_savings_df</span><span class="p">()</span>

    <span class="c1"># Calculate costs</span>
    <span class="n">num_converts</span> <span class="o">=</span> <span class="n">compute_hp_converts_from_df</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">npas_this_year</span><span class="p">,</span> <span class="n">cumulative</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">npa_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">npa_investment_cost</span> <span class="o">=</span> <span class="n">npa_install_cost</span> <span class="o">*</span> <span class="n">num_converts</span>
    <span class="n">avoided_lpp_cost</span> <span class="o">=</span> <span class="n">compute_npa_pipe_cost_avoided_from_df</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">npas_this_year</span><span class="p">)</span>

    <span class="c1"># Calculate NPVs</span>
    <span class="n">npa_npv</span> <span class="o">=</span> <span class="n">npa_investment_cost</span>  <span class="c1"># npa investment is opex so costs are recouped in the same year with no ror</span>

    <span class="n">avoided_lpp_npv</span> <span class="o">=</span> <span class="n">compute_npv_of_capex_investment</span><span class="p">(</span>
        <span class="n">initial_cost</span><span class="o">=</span><span class="n">avoided_lpp_cost</span><span class="p">,</span>
        <span class="n">lifetime</span><span class="o">=</span><span class="n">pipeline_depreciation_lifetime</span><span class="p">,</span>
        <span class="n">ror</span><span class="o">=</span><span class="n">gas_ror</span><span class="p">,</span>
        <span class="n">real_dollar_discount_rate</span><span class="o">=</span><span class="n">npv_discount_rate</span><span class="p">,</span>
        <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">savings_amount</span> <span class="o">=</span> <span class="p">(</span><span class="n">avoided_lpp_npv</span> <span class="o">-</span> <span class="n">npa_npv</span><span class="p">)</span> <span class="o">*</span> <span class="n">performance_incentive_pct</span>

    <span class="k">if</span> <span class="n">savings_amount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">NpvSavingsProject</span><span class="p">(</span>
            <span class="n">project_year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
            <span class="n">savings_amount</span><span class="o">=</span><span class="n">savings_amount</span><span class="p">,</span>
            <span class="n">payback_period</span><span class="o">=</span><span class="n">incentive_payback_period</span><span class="p">,</span>  <span class="c1"># 10-year incentive period</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to_df</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">return_empty_npv_savings_df</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.capex_project.compute_performance_incentive_this_year" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_performance_incentive_this_year</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span></code>

<a href="#npa_howtopay.capex_project.compute_performance_incentive_this_year" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute the ratebase value for a given year from NPV savings projects.</p>
<p>For each savings project, the ratebase value is the savings amount divided by payback period.
Projects that haven't started yet (year &lt; project_year) have zero ratebase value.
Projects that are fully paid back have zero ratebase value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The year to compute ratebase for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing NPV savings projects with columns:
- project_year: int - Year project was initiated
- savings_amount: float - Total NPV savings amount
- payback_period: int - Number of years to pay incentives</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total ratebase value for the year across all savings projects</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/capex_project.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_performance_incentive_this_year</span><span class="p">(</span><span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the ratebase value for a given year from NPV savings projects.</span>

<span class="sd">    For each savings project, the ratebase value is the savings amount divided by payback period.</span>
<span class="sd">    Projects that haven&#39;t started yet (year &lt; project_year) have zero ratebase value.</span>
<span class="sd">    Projects that are fully paid back have zero ratebase value.</span>

<span class="sd">    Args:</span>
<span class="sd">        year: The year to compute ratebase for</span>
<span class="sd">        df: DataFrame containing NPV savings projects with columns:</span>
<span class="sd">            - project_year: int - Year project was initiated</span>
<span class="sd">            - savings_amount: float - Total NPV savings amount</span>
<span class="sd">            - payback_period: int - Number of years to pay incentives</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Total ratebase value for the year across all savings projects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">when</span><span class="p">((</span><span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;project_year&quot;</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;end_year&quot;</span><span class="p">)))</span>
        <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;savings_amount&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;payback_period&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;annual_ratebase_contribution&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;annual_ratebase_contribution&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.capex_project.compute_ratebase_from_capex_projects" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_ratebase_from_capex_projects</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span></code>

<a href="#npa_howtopay.capex_project.compute_ratebase_from_capex_projects" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute the ratebase value for a given year from capital projects.</p>
<p>For each project, the ratebase value declines linearly from the original cost to zero over the depreciation lifetime.
Projects that haven't started yet (year &lt; project_year) have zero ratebase value.
Projects that are fully depreciated have zero ratebase value.
Projects that are in the year of the project have the full original cost added to the ratebase.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The year to compute ratebase for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing capital projects with columns:
- project_year: int - Year project was initiated
- original_cost: float - Original cost of the project
- depreciation_lifetime: int - Number of years to depreciate over</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total ratebase value for the year across all projects</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/capex_project.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_ratebase_from_capex_projects</span><span class="p">(</span><span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the ratebase value for a given year from capital projects.</span>

<span class="sd">    For each project, the ratebase value declines linearly from the original cost to zero over the depreciation lifetime.</span>
<span class="sd">    Projects that haven&#39;t started yet (year &lt; project_year) have zero ratebase value.</span>
<span class="sd">    Projects that are fully depreciated have zero ratebase value.</span>
<span class="sd">    Projects that are in the year of the project have the full original cost added to the ratebase.</span>

<span class="sd">    Args:</span>
<span class="sd">        year: The year to compute ratebase for</span>
<span class="sd">        df: DataFrame containing capital projects with columns:</span>
<span class="sd">            - project_year: int - Year project was initiated</span>
<span class="sd">            - original_cost: float - Original cost of the project</span>
<span class="sd">            - depreciation_lifetime: int - Number of years to depreciate over</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Total ratebase value for the year across all projects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;project_year&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="o">.</span><span class="n">otherwise</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">-</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;project_year&quot;</span><span class="p">))</span> <span class="o">/</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;depreciation_lifetime&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower_bound</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;depreciation_fraction&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;depreciation_fraction&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;original_cost&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.capex_project.get_grid_upgrade_capex_projects" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_grid_upgrade_capex_projects</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">npa_projects</span><span class="p">,</span> <span class="n">peak_hp_kw</span><span class="p">,</span> <span class="n">peak_aircon_kw</span><span class="p">,</span> <span class="n">distribution_cost_per_peak_kw_increase</span><span class="p">,</span> <span class="n">grid_upgrade_depreciation_lifetime</span><span class="p">)</span></code>

<a href="#npa_howtopay.capex_project.get_grid_upgrade_capex_projects" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate capex projects for grid upgrades needed to support NPA installations.</p>
<p>This function calculates the required grid upgrades based on the peak power increase
from heat pumps and air conditioners installed as part of NPA projects. The cost
scales linearly with the total peak power increase.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The year to generate projects for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>npa_projects</code>
            </td>
            <td>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing NPA project details</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>peak_hp_kw</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Peak power draw in kW for a heat pump</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>peak_aircon_kw</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Peak power draw in kW for an air conditioner</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>distribution_cost_per_peak_kw_increase</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cost per kW of increasing grid capacity in year of project</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>grid_upgrade_depreciation_lifetime</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Depreciation lifetime in years for grid upgrades</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pl.DataFrame with columns:
- project_year: Year the project was initiated
- project_type: "grid_upgrade" for grid capacity upgrades
- original_cost: Total cost of grid upgrades
- depreciation_lifetime: Depreciation lifetime in years</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/capex_project.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_grid_upgrade_capex_projects</span><span class="p">(</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">npa_projects</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">peak_hp_kw</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">peak_aircon_kw</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">distribution_cost_per_peak_kw_increase</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">grid_upgrade_depreciation_lifetime</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate capex projects for grid upgrades needed to support NPA installations.</span>

<span class="sd">    This function calculates the required grid upgrades based on the peak power increase</span>
<span class="sd">    from heat pumps and air conditioners installed as part of NPA projects. The cost</span>
<span class="sd">    scales linearly with the total peak power increase.</span>

<span class="sd">    Args:</span>
<span class="sd">        year: The year to generate projects for</span>
<span class="sd">        npa_projects: DataFrame containing NPA project details</span>
<span class="sd">        peak_hp_kw: Peak power draw in kW for a heat pump</span>
<span class="sd">        peak_aircon_kw: Peak power draw in kW for an air conditioner</span>
<span class="sd">        distribution_cost_per_peak_kw_increase: Cost per kW of increasing grid capacity in year of project</span>
<span class="sd">        grid_upgrade_depreciation_lifetime: Depreciation lifetime in years for grid upgrades</span>

<span class="sd">    Returns:</span>
<span class="sd">        pl.DataFrame with columns:</span>
<span class="sd">            - project_year: Year the project was initiated</span>
<span class="sd">            - project_type: &quot;grid_upgrade&quot; for grid capacity upgrades</span>
<span class="sd">            - original_cost: Total cost of grid upgrades</span>
<span class="sd">            - depreciation_lifetime: Depreciation lifetime in years</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">npas_this_year</span> <span class="o">=</span> <span class="n">npa_projects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;project_year&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">year</span><span class="p">)</span>
    <span class="n">peak_kw_increase</span> <span class="o">=</span> <span class="n">compute_peak_kw_increase_from_df</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">npas_this_year</span><span class="p">,</span> <span class="n">peak_hp_kw</span><span class="p">,</span> <span class="n">peak_aircon_kw</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">peak_kw_increase</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CapexProject</span><span class="p">(</span>
            <span class="n">project_year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
            <span class="n">project_type</span><span class="o">=</span><span class="s2">&quot;grid_upgrade&quot;</span><span class="p">,</span>
            <span class="n">original_cost</span><span class="o">=</span><span class="n">peak_kw_increase</span> <span class="o">*</span> <span class="n">distribution_cost_per_peak_kw_increase</span><span class="p">,</span>
            <span class="n">depreciation_lifetime</span><span class="o">=</span><span class="n">grid_upgrade_depreciation_lifetime</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to_df</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">return_empty_capex_df</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.capex_project.get_lpp_gas_capex_projects" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_lpp_gas_capex_projects</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">gas_bau_lpp_costs_per_year</span><span class="p">,</span> <span class="n">npa_projects</span><span class="p">,</span> <span class="n">depreciation_lifetime</span><span class="p">)</span></code>

<a href="#npa_howtopay.capex_project.get_lpp_gas_capex_projects" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate capex projects for leak-prone pipe (LPP) replacement in the gas system.</p>
<p>This function calculates the remaining pipe replacement costs after accounting for pipe
replacements avoided by NPA projects. If NPAs avoid all planned pipe replacements in a given
year, returns an empty dataframe.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The year to generate projects for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gas_bau_lpp_costs_per_year</code>
            </td>
            <td>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing business-as-usual pipe replacement costs
with columns:
- year: Year of planned replacement
- cost: Cost of planned replacement
Note: Multiple entries may exist per year</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>npa_projects</code>
            </td>
            <td>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing NPA project details, used to calculate avoided pipe costs</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>depreciation_lifetime</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Depreciation lifetime in years for pipe replacement projects</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pl.DataFrame with columns:
- project_year: Year the project was initiated
- project_type: "pipeline" for pipe replacement projects
- original_cost: Cost of the project after subtracting avoided costs
- depreciation_lifetime: Depreciation lifetime in years
- retirement_year: Year the project is fully depreciated</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/capex_project.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_lpp_gas_capex_projects</span><span class="p">(</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">gas_bau_lpp_costs_per_year</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">npa_projects</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">depreciation_lifetime</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate capex projects for leak-prone pipe (LPP) replacement in the gas system.</span>

<span class="sd">    This function calculates the remaining pipe replacement costs after accounting for pipe</span>
<span class="sd">    replacements avoided by NPA projects. If NPAs avoid all planned pipe replacements in a given</span>
<span class="sd">    year, returns an empty dataframe.</span>

<span class="sd">    Args:</span>
<span class="sd">        year: The year to generate projects for</span>
<span class="sd">        gas_bau_lpp_costs_per_year: DataFrame containing business-as-usual pipe replacement costs</span>
<span class="sd">            with columns:</span>
<span class="sd">            - year: Year of planned replacement</span>
<span class="sd">            - cost: Cost of planned replacement</span>
<span class="sd">            Note: Multiple entries may exist per year</span>
<span class="sd">        npa_projects: DataFrame containing NPA project details, used to calculate avoided pipe costs</span>
<span class="sd">        depreciation_lifetime: Depreciation lifetime in years for pipe replacement projects</span>

<span class="sd">    Returns:</span>
<span class="sd">        pl.DataFrame with columns:</span>
<span class="sd">            - project_year: Year the project was initiated</span>
<span class="sd">            - project_type: &quot;pipeline&quot; for pipe replacement projects</span>
<span class="sd">            - original_cost: Cost of the project after subtracting avoided costs</span>
<span class="sd">            - depreciation_lifetime: Depreciation lifetime in years</span>
<span class="sd">            - retirement_year: Year the project is fully depreciated</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">npas_this_year</span> <span class="o">=</span> <span class="n">npa_projects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;project_year&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">year</span><span class="p">)</span>
    <span class="n">npa_pipe_costs_avoided</span> <span class="o">=</span> <span class="n">compute_npa_pipe_cost_avoided_from_df</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">npas_this_year</span><span class="p">)</span>
    <span class="n">bau_pipe_replacement_costs</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">gas_bau_lpp_costs_per_year</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cost&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">remaining_pipe_replacement_cost</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bau_pipe_replacement_costs</span> <span class="o">-</span> <span class="n">npa_pipe_costs_avoided</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">remaining_pipe_replacement_cost</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CapexProject</span><span class="p">(</span>
            <span class="n">project_year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
            <span class="n">project_type</span><span class="o">=</span><span class="s2">&quot;pipeline&quot;</span><span class="p">,</span>
            <span class="n">original_cost</span><span class="o">=</span><span class="n">remaining_pipe_replacement_cost</span><span class="p">,</span>
            <span class="n">depreciation_lifetime</span><span class="o">=</span><span class="n">depreciation_lifetime</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to_df</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">return_empty_capex_df</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.capex_project.get_non_lpp_gas_capex_projects" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_non_lpp_gas_capex_projects</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">current_ratebase</span><span class="p">,</span> <span class="n">baseline_non_lpp_gas_ratebase_growth</span><span class="p">,</span> <span class="n">depreciation_lifetime</span><span class="p">,</span> <span class="n">construction_inflation_rate</span><span class="p">)</span></code>

<a href="#npa_howtopay.capex_project.get_non_lpp_gas_capex_projects" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate capex projects for non-LPP (non-leak prone pipe) gas infrastructure.</p>
<p>These represent routine gas infrastructure investments not related to pipe replacement or npas,
such as meter replacements, regulator stations, etc. The cost is calculated as a
percentage of current ratebase, adjusted for construction cost inflation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The year to generate projects for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_ratebase</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current value of the gas utility's ratebase</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>baseline_non_lpp_gas_ratebase_growth</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Annual growth rate for non-LPP capex as fraction of ratebase</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>depreciation_lifetime</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Blended depreciation lifetime in years for these projects</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>construction_inflation_rate</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Annual inflation rate for construction costs</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pl.DataFrame with columns:
- project_year: Year the project was initiated
- project_type: "misc" for miscellaneous gas infrastructure
- original_cost: Cost of the project
- depreciation_lifetime: Depreciation lifetime in years
- retirement_year: Year the project is fully depreciated</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/capex_project.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_non_lpp_gas_capex_projects</span><span class="p">(</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">current_ratebase</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">baseline_non_lpp_gas_ratebase_growth</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">depreciation_lifetime</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">construction_inflation_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate capex projects for non-LPP (non-leak prone pipe) gas infrastructure.</span>

<span class="sd">    These represent routine gas infrastructure investments not related to pipe replacement or npas,</span>
<span class="sd">    such as meter replacements, regulator stations, etc. The cost is calculated as a</span>
<span class="sd">    percentage of current ratebase, adjusted for construction cost inflation.</span>

<span class="sd">    Args:</span>
<span class="sd">        year: The year to generate projects for</span>
<span class="sd">        current_ratebase: Current value of the gas utility&#39;s ratebase</span>
<span class="sd">        baseline_non_lpp_gas_ratebase_growth: Annual growth rate for non-LPP capex as fraction of ratebase</span>
<span class="sd">        depreciation_lifetime: Blended depreciation lifetime in years for these projects</span>
<span class="sd">        construction_inflation_rate: Annual inflation rate for construction costs</span>

<span class="sd">    Returns:</span>
<span class="sd">        pl.DataFrame with columns:</span>
<span class="sd">            - project_year: Year the project was initiated</span>
<span class="sd">            - project_type: &quot;misc&quot; for miscellaneous gas infrastructure</span>
<span class="sd">            - original_cost: Cost of the project</span>
<span class="sd">            - depreciation_lifetime: Depreciation lifetime in years</span>
<span class="sd">            - retirement_year: Year the project is fully depreciated</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">CapexProject</span><span class="p">(</span>
        <span class="n">project_year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
        <span class="n">project_type</span><span class="o">=</span><span class="s2">&quot;misc&quot;</span><span class="p">,</span>
        <span class="n">original_cost</span><span class="o">=</span><span class="n">current_ratebase</span> <span class="o">*</span> <span class="n">baseline_non_lpp_gas_ratebase_growth</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">construction_inflation_rate</span><span class="p">),</span>
        <span class="n">depreciation_lifetime</span><span class="o">=</span><span class="n">depreciation_lifetime</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">to_df</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.capex_project.get_non_npa_electric_capex_projects" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_non_npa_electric_capex_projects</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">current_ratebase</span><span class="p">,</span> <span class="n">baseline_electric_ratebase_growth</span><span class="p">,</span> <span class="n">depreciation_lifetime</span><span class="p">,</span> <span class="n">construction_inflation_rate</span><span class="p">)</span></code>

<a href="#npa_howtopay.capex_project.get_non_npa_electric_capex_projects" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate capex projects for non-NPA non-grid upgrade electric system upgrades.</p>
<p>This function calculates the baseline capital expenditures for the electric system,
excluding NPA-related projects. The expenditure grows with both the baseline growth rate
and construction inflation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The year to generate projects for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_ratebase</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current value of the electric utility's ratebase</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>baseline_electric_ratebase_growth</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Annual growth rate of non-NPA electric capex as fraction of ratebase</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>depreciation_lifetime</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Blended depreciation lifetime in years for electric system projects</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>construction_inflation_rate</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Annual inflation rate for construction costs</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pl.DataFrame with columns:
- project_year: Year the project was initiated
- project_type: "misc" for miscellaneous electric system upgrades
- original_cost: Cost of the project including construction inflation
- depreciation_lifetime: Depreciation lifetime in years</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/capex_project.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_non_npa_electric_capex_projects</span><span class="p">(</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">current_ratebase</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">baseline_electric_ratebase_growth</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">depreciation_lifetime</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">construction_inflation_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate capex projects for non-NPA non-grid upgrade electric system upgrades.</span>

<span class="sd">    This function calculates the baseline capital expenditures for the electric system,</span>
<span class="sd">    excluding NPA-related projects. The expenditure grows with both the baseline growth rate</span>
<span class="sd">    and construction inflation.</span>

<span class="sd">    Args:</span>
<span class="sd">        year: The year to generate projects for</span>
<span class="sd">        current_ratebase: Current value of the electric utility&#39;s ratebase</span>
<span class="sd">        baseline_electric_ratebase_growth: Annual growth rate of non-NPA electric capex as fraction of ratebase</span>
<span class="sd">        depreciation_lifetime: Blended depreciation lifetime in years for electric system projects</span>
<span class="sd">        construction_inflation_rate: Annual inflation rate for construction costs</span>

<span class="sd">    Returns:</span>
<span class="sd">        pl.DataFrame with columns:</span>
<span class="sd">            - project_year: Year the project was initiated</span>
<span class="sd">            - project_type: &quot;misc&quot; for miscellaneous electric system upgrades</span>
<span class="sd">            - original_cost: Cost of the project including construction inflation</span>
<span class="sd">            - depreciation_lifetime: Depreciation lifetime in years</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">CapexProject</span><span class="p">(</span>
        <span class="n">project_year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
        <span class="n">project_type</span><span class="o">=</span><span class="s2">&quot;misc&quot;</span><span class="p">,</span>
        <span class="n">original_cost</span><span class="o">=</span><span class="n">current_ratebase</span> <span class="o">*</span> <span class="n">baseline_electric_ratebase_growth</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">construction_inflation_rate</span><span class="p">),</span>
        <span class="n">depreciation_lifetime</span><span class="o">=</span><span class="n">depreciation_lifetime</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">to_df</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.capex_project.get_npa_capex_projects" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_npa_capex_projects</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">npa_projects</span><span class="p">,</span> <span class="n">npa_install_cost</span><span class="p">,</span> <span class="n">npa_lifetime</span><span class="p">)</span></code>

<a href="#npa_howtopay.capex_project.get_npa_capex_projects" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate capex projects for NPA (non-pipe alternative) installations.</p>
<p>This function calculates the capital costs associated with installing NPAs in a given year.
The total cost is based on the number of heat pump conversions and the per-unit installation cost.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The year to generate projects for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>npa_projects</code>
            </td>
            <td>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing NPA project details</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>npa_install_cost</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cost per household of installing an NPA</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>npa_lifetime</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Expected lifetime in years of an NPA installation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pl.DataFrame with columns:
- project_year: Year the project was initiated
- project_type: "npa" for NPA installations
- original_cost: Total cost of NPA installations
- depreciation_lifetime: Depreciation lifetime in years</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/capex_project.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_npa_capex_projects</span><span class="p">(</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">npa_projects</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">npa_install_cost</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">npa_lifetime</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate capex projects for NPA (non-pipe alternative) installations.</span>

<span class="sd">    This function calculates the capital costs associated with installing NPAs in a given year.</span>
<span class="sd">    The total cost is based on the number of heat pump conversions and the per-unit installation cost.</span>

<span class="sd">    Args:</span>
<span class="sd">        year: The year to generate projects for</span>
<span class="sd">        npa_projects: DataFrame containing NPA project details</span>
<span class="sd">        npa_install_cost: Cost per household of installing an NPA</span>
<span class="sd">        npa_lifetime: Expected lifetime in years of an NPA installation</span>

<span class="sd">    Returns:</span>
<span class="sd">        pl.DataFrame with columns:</span>
<span class="sd">            - project_year: Year the project was initiated</span>
<span class="sd">            - project_type: &quot;npa&quot; for NPA installations</span>
<span class="sd">            - original_cost: Total cost of NPA installations</span>
<span class="sd">            - depreciation_lifetime: Depreciation lifetime in years</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">npas_this_year</span> <span class="o">=</span> <span class="n">npa_projects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;project_year&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">year</span><span class="p">)</span>
    <span class="n">npa_total_cost</span> <span class="o">=</span> <span class="n">npa_install_cost</span> <span class="o">*</span> <span class="n">compute_hp_converts_from_df</span><span class="p">(</span>
        <span class="n">year</span><span class="p">,</span> <span class="n">npas_this_year</span><span class="p">,</span> <span class="n">cumulative</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">npa_only</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">npa_total_cost</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CapexProject</span><span class="p">(</span>
            <span class="n">project_year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span> <span class="n">project_type</span><span class="o">=</span><span class="s2">&quot;npa&quot;</span><span class="p">,</span> <span class="n">original_cost</span><span class="o">=</span><span class="n">npa_total_cost</span><span class="p">,</span> <span class="n">depreciation_lifetime</span><span class="o">=</span><span class="n">npa_lifetime</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to_df</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">return_empty_capex_df</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.capex_project.get_synthetic_initial_capex_projects" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_synthetic_initial_capex_projects</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span> <span class="n">initial_ratebase</span><span class="p">,</span> <span class="n">depreciation_lifetime</span><span class="p">)</span></code>

<a href="#npa_howtopay.capex_project.get_synthetic_initial_capex_projects" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate synthetic capex projects to represent the projects that make up the initial ratebase.</p>
<p>Creates a series of historical capex projects that would result in the given initial ratebase value, assuming straight-line depreciation. Uses the triangular number formula to create a uniform distribution of projects over the depreciation lifetime, where each project has the same original cost. Projects are distributed evenly over depreciation_lifetime years leading up to start_year.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>start_year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The first year of the model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>initial_ratebase</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target ratebase value at start_year</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>depreciation_lifetime</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The blended depreciation lifetime for the synthetic projects</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pl.DataFrame with columns:
- project_year: Year the project was initiated
- project_type: "synthetic_initial"
- original_cost: Cost of the project
- depreciation_lifetime: Depreciation lifetime in years
- retirement_year: Year the project is fully depreciated</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/capex_project.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_synthetic_initial_capex_projects</span><span class="p">(</span>
    <span class="n">start_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">initial_ratebase</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">depreciation_lifetime</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate synthetic capex projects to represent the projects that make up the initial ratebase.</span>

<span class="sd">    Creates a series of historical capex projects that would result in the given initial ratebase value, assuming straight-line depreciation. Uses the triangular number formula to create a uniform distribution of projects over the depreciation lifetime, where each project has the same original cost. Projects are distributed evenly over depreciation_lifetime years leading up to start_year.</span>

<span class="sd">    Args:</span>
<span class="sd">        start_year: The first year of the model</span>
<span class="sd">        initial_ratebase: The target ratebase value at start_year</span>
<span class="sd">        depreciation_lifetime: The blended depreciation lifetime for the synthetic projects</span>

<span class="sd">    Returns:</span>
<span class="sd">        pl.DataFrame with columns:</span>
<span class="sd">            - project_year: Year the project was initiated</span>
<span class="sd">            - project_type: &quot;synthetic_initial&quot;</span>
<span class="sd">            - original_cost: Cost of the project</span>
<span class="sd">            - depreciation_lifetime: Depreciation lifetime in years</span>
<span class="sd">            - retirement_year: Year the project is fully depreciated</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_weight</span> <span class="o">=</span> <span class="p">(</span><span class="n">depreciation_lifetime</span> <span class="o">*</span> <span class="p">(</span><span class="n">depreciation_lifetime</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">depreciation_lifetime</span>
    <span class="n">est_original_cost_per_year</span> <span class="o">=</span> <span class="n">initial_ratebase</span> <span class="o">/</span> <span class="n">total_weight</span>
    <span class="n">project_years</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_year</span> <span class="o">-</span> <span class="n">depreciation_lifetime</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">start_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">&quot;project_year&quot;</span><span class="p">:</span> <span class="n">project_years</span><span class="p">,</span>
        <span class="s2">&quot;project_type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;synthetic_initial&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">depreciation_lifetime</span><span class="p">,</span>
        <span class="s2">&quot;original_cost&quot;</span><span class="p">:</span> <span class="n">est_original_cost_per_year</span><span class="p">,</span>
        <span class="s2">&quot;depreciation_lifetime&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">depreciation_lifetime</span><span class="p">]</span> <span class="o">*</span> <span class="n">depreciation_lifetime</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Int64</span><span class="p">),</span>
        <span class="s2">&quot;retirement_year&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">year</span> <span class="o">+</span> <span class="n">depreciation_lifetime</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">project_years</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Int64</span><span class="p">),</span>
    <span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.capex_project.return_empty_npv_savings_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">return_empty_npv_savings_df</span><span class="p">()</span></code>

<a href="#npa_howtopay.capex_project.return_empty_npv_savings_df" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return empty DataFrame for NPV savings projects with proper schema.</p>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/capex_project.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">return_empty_npv_savings_df</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return empty DataFrame for NPV savings projects with proper schema.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">&quot;project_year&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Int64</span><span class="p">),</span>
        <span class="s2">&quot;savings_amount&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">),</span>
        <span class="s2">&quot;payback_period&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Int64</span><span class="p">),</span>
        <span class="s2">&quot;end_year&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Int64</span><span class="p">),</span>
    <span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="npa_howtopay.npa_project" class="doc doc-heading">
            <code>npa_howtopay.npa_project</code>


<a href="#npa_howtopay.npa_project" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.npa_project.append_scattershot_electrification_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">append_scattershot_electrification_df</span><span class="p">(</span><span class="n">npa_projects_df</span><span class="p">,</span> <span class="n">scattershot_electrification_df</span><span class="p">)</span></code>

<a href="#npa_howtopay.npa_project.append_scattershot_electrification_df" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Append a dataframe of scattershot electrification projects to the npa projects df.
Scattershot electrification projects match the schema for npa projects, but will only affect the number of users and total electric usage, not anything related to pipe value or grid upgrades. It is meant to capture customers leaving the gas network independent of NPA projects.</p>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/npa_project.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">append_scattershot_electrification_df</span><span class="p">(</span>
    <span class="n">npa_projects_df</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">scattershot_electrification_df</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Append a dataframe of scattershot electrification projects to the npa projects df.</span>
<span class="sd">    Scattershot electrification projects match the schema for npa projects, but will only affect the number of users and total electric usage, not anything related to pipe value or grid upgrades. It is meant to capture customers leaving the gas network independent of NPA projects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scattershot_with_npa_cols</span> <span class="o">=</span> <span class="n">scattershot_electrification_df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;pipe_value_per_user&quot;</span><span class="p">),</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;pipe_decomm_cost_per_user&quot;</span><span class="p">),</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;peak_kw_winter_headroom&quot;</span><span class="p">),</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;peak_kw_summer_headroom&quot;</span><span class="p">),</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;aircon_percent_adoption_pre_npa&quot;</span><span class="p">),</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;is_scattershot&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">npa_projects_df</span><span class="p">,</span> <span class="n">scattershot_with_npa_cols</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="npa_howtopay.web_params" class="doc doc-heading">
            <code>npa_howtopay.web_params</code>


<a href="#npa_howtopay.web_params" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.web_params.create_scattershot_electrification_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_scattershot_electrification_df</span><span class="p">(</span><span class="n">web_params</span><span class="p">,</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="p">)</span></code>

<a href="#npa_howtopay.web_params.create_scattershot_electrification_df" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate a dataframe of scattershot electrification projects, one per year.
The projects are distributed evenly across the years. These match the schema for npa projects, but will only
affect the number of users, not anything related to pipe value or grid upgrades</p>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/web_params.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_scattershot_electrification_df</span><span class="p">(</span>
    <span class="n">web_params</span><span class="p">:</span> <span class="n">WebParams</span><span class="p">,</span>
    <span class="n">start_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">end_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a dataframe of scattershot electrification projects, one per year.</span>
<span class="sd">    The projects are distributed evenly across the years. These match the schema for npa projects, but will only</span>
<span class="sd">    affect the number of users, not anything related to pipe value or grid upgrades</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">years</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">num_years</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">years</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">&quot;project_year&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">years</span><span class="p">),</span>
        <span class="s2">&quot;num_converts&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">web_params</span><span class="o">.</span><span class="n">scattershot_electrification_users_per_year</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_years</span><span class="p">,</span>
    <span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npa_howtopay.web_params.create_time_series_from_web_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_time_series_from_web_params</span><span class="p">(</span><span class="n">web_params</span><span class="p">,</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="p">,</span> <span class="n">cost_inflation_rate</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></code>

<a href="#npa_howtopay.web_params.create_time_series_from_web_params" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create all time series DataFrames from web parameters</p>


            <details class="quote">
              <summary>Source code in <code>src/npa_howtopay/web_params.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_time_series_from_web_params</span><span class="p">(</span>
    <span class="n">web_params</span><span class="p">:</span> <span class="n">WebParams</span><span class="p">,</span> <span class="n">start_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">cost_inflation_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create all time series DataFrames from web parameters&quot;&quot;&quot;</span>
    <span class="n">npa_year_end</span> <span class="o">=</span> <span class="n">web_params</span><span class="o">.</span><span class="n">npa_year_end</span> <span class="k">if</span> <span class="n">web_params</span><span class="o">.</span><span class="n">npa_year_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">end_year</span>
    <span class="n">npa_year_start</span> <span class="o">=</span> <span class="n">web_params</span><span class="o">.</span><span class="n">npa_year_start</span> <span class="k">if</span> <span class="n">web_params</span><span class="o">.</span><span class="n">npa_year_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">start_year</span>

    <span class="k">if</span> <span class="n">npa_year_start</span> <span class="o">&lt;</span> <span class="n">start_year</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;npa_year_start must be greater than or equal to SharedParams.start_year&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">npa_year_end</span> <span class="o">&gt;</span> <span class="n">end_year</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;npa_year_end must be less than or equal to npa_end_year&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;npa_projects&quot;</span><span class="p">:</span> <span class="n">create_npa_projects</span><span class="p">(</span><span class="n">web_params</span><span class="p">,</span> <span class="n">npa_year_start</span><span class="p">,</span> <span class="n">npa_year_end</span><span class="p">),</span>
        <span class="s2">&quot;scattershot_electrification_users_per_year&quot;</span><span class="p">:</span> <span class="n">create_scattershot_electrification_df</span><span class="p">(</span>
            <span class="n">web_params</span><span class="p">,</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span>
        <span class="p">),</span>
        <span class="s2">&quot;gas_fixed_overhead_costs&quot;</span><span class="p">:</span> <span class="n">create_gas_fixed_overhead_costs</span><span class="p">(</span>
            <span class="n">web_params</span><span class="p">,</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="p">,</span> <span class="n">cost_inflation_rate</span>
        <span class="p">),</span>
        <span class="s2">&quot;electric_fixed_overhead_costs&quot;</span><span class="p">:</span> <span class="n">create_electric_fixed_overhead_costs</span><span class="p">(</span>
            <span class="n">web_params</span><span class="p">,</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="p">,</span> <span class="n">cost_inflation_rate</span>
        <span class="p">),</span>
        <span class="s2">&quot;gas_bau_lpp_costs_per_year&quot;</span><span class="p">:</span> <span class="n">create_gas_bau_lpp_costs_per_year</span><span class="p">(</span>
            <span class="n">web_params</span><span class="p">,</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="p">,</span> <span class="n">cost_inflation_rate</span>
        <span class="p">),</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Maintained by <a href="https://switchbox-data.com">switchbox-data</a>.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/switchbox-data/npa-howtopay" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/npa-howtopay" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../javascripts/mathjax-config.js"></script>
      
    
  </body>
</html>